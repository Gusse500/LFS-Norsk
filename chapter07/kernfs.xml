<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
  "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../general.ent">
  %general-entities;
]>

<sect1 id="ch-tools-kernfs">
  <?dbhtml filename="kernfs.html"?>

  <title>Klargjøring av virtuelle kjernefilsystemer</title>

  <indexterm zone="ch-tools-kernfs">
    <primary sortas="e-/dev/">/dev/*</primary>
  </indexterm>

    <para>Ulike filsystemer eksportert av kjernen brukes til å kommunisere til
    og fra selve kjernen. Disse filsystemene er virtuelle ved at ingen disk
    plass brukes til dem. Innholdet i filsystemene ligger i
    minnet.</para>

    <para>Begynn med å lage mapper som filsystemene vil bli
    montert på:</para>

<screen><userinput>mkdir -pv $LFS/{dev,proc,sys,run}</userinput></screen>

  <sect2 id="ch-tools-bindmount">
    <title>Montering og fylling av /dev</title>

      <para>Under en normal oppstart, monterer kjernen automatisk
      <systemitem class="filesystem">devtmpfs</systemitem> filsystemet på
      <filename class="directory">/dev</filename> mappen, og tillater
      enheter som skal opprettes dynamisk på det virtuelle filsystemet etter hvert som de
      oppdages eller åpnes. Enhetsoppretting gjøres vanligvis i løpet av
      oppstartsprosessen av kjernen og Udev.
      Siden dette nye systemet ennå ikke har Udev og
      har ennå ikke blitt startet opp, er det nødvendig å montere og fylle
      <filename class="directory">/dev</filename> manuelt. Dette
      oppnås ved å binde montering av vertssystemets
      <filename class="directory">/dev</filename> mappe. Å binde montering er
      en spesiell type montering som lar deg lage et speil av en
      katalog eller monteringspunkt til et annet sted. Bruk følgende
      kommando for å oppnå dette:</para>

<screen><userinput>mount -v --bind /dev $LFS/dev</userinput></screen>

  </sect2>

  <sect2 id="ch-tools-kernfsmount">
    <title>Montering av virtuelle kjernefilsystemer</title>

      <para>Monter nå de gjenværende virtuelle kjernefilsystemene:</para>

<screen><userinput>mount -v --bind /dev/pts $LFS/dev/pts
mount -vt proc proc $LFS/proc
mount -vt sysfs sysfs $LFS/sys
mount -vt tmpfs tmpfs $LFS/run</userinput></screen>
<!--
    <variablelist>
      <title>Betydningen av monteringsalternativene for devpts:</title>

      <varlistentry>
        <term><parameter>gid=5</parameter></term>
        <listitem>
          <para>Dette sikrer at alle devpts opprettede enhetsnoder eies av
          gruppe ID 5. Dette er IDen vi skal bruke senere for <systemitem
          class="groupname">tty</systemitem> gruppen.  Vi bruker gruppe-ID i stedet
          for et navn, siden vertssystemet kan bruke en annen ID for sitt
          <systemitem class="groupname">tty</systemitem> gruppen.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term><parameter>mode=0620</parameter></term>
        <listitem>
          <para>Dette sikrer at alle devpts opprettede enhetsnoder har modus 0620
          (bruker lesbar og skrivbar, gruppeskrivbar). Sammen med
          alternativet ovenfor, sikrer dette at devpts vil opprette enhetsnoder som
          oppfylle kravene til grantpt(), som betyr Glibc
          <command>pt_chown</command> hjelper binær (som ikke er installert som
          standard) ikke er nødvendig.</para>
        </listitem>
      </varlistentry>

    </variablelist>
-->
      <para>I noen vertssystemer, <filename>/dev/shm</filename> er en
      symbolsk lenke til <filename class="directory">/run/shm</filename>.
      /run tmpfs ble montert ovenfor, så i dette tilfellet er det bare en
      mappe som må opprettes.</para>

<screen><userinput>if [ -h $LFS/dev/shm ]; then
  mkdir -pv $LFS/$(readlink $LFS/dev/shm)
fi</userinput></screen>

  </sect2>

</sect1>
