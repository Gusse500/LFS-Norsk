<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
  "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../general.ent">
  %general-entities;
]>

<sect1 id="ch-bootable-grub" role="wrap">
  <?dbhtml filename="grub.html"?>

  <sect1info condition="script">
    <productname>grub</productname>
    <productnumber>&grub-version;</productnumber>
    <address>&grub-url;</address>
  </sect1info>

  <title>Bruke GRUB til å sette opp oppstartsprosessen</title>

  <note>
    <para>
      Hvis systemet ditt har UEFI støtte og du ønsker å starte LFS med UEFI,
       bør du hoppe over denne siden og konfigurere GRUB med UEFI støtte
       ved å bruke instruksjonene i
      <ulink url="&blfs-book;postlfs/grub-setup.html">BLFS siden</ulink>.
    </para>
  </note>

  <sect2>
    <title>Introduksjon</title>

    <warning><para>Å konfigurere GRUB feil kan gjøre systemet ditt
     ubrukelig uten en alternativ oppstartsenhet som en CD-ROM eller oppstartbar
     USB-stasjon. Denne delen er ikke nødvendig for å starte opp LFS systemet. Du kan
     bare endre din nåværende oppstartslaster, f.eks. Grub-Legacy, GRUB2 eller
     LILO.</para></warning>

    <para> Sørg for at en nødoppstartsdiskett er klar til å <quote>redde</quote>
     datamaskinen hvis datamaskinen blir ubrukelig (ikke-oppstartbar). Hvis du ikke
     allerede har en oppstartsenhet, kan du opprette en. For at prosedyren
     nedenfor skal fungere, så må du hoppe til BLFS og installere
    <userinput>xorriso</userinput> fra <ulink
    url="&blfs-book;multimedia/libisoburn.html">
    libisoburn</ulink> pakken.</para>

<screen role="nodump"><userinput>cd /tmp
grub-mkrescue --output=grub-img.iso
xorriso -as cdrecord -v dev=/dev/cdrw blank=as_needed grub-img.iso</userinput></screen>

  </sect2>

  <sect2>
    <title>GRUB navnekonvensjoner</title>

    <para>GRUB bruker sin egen navnestruktur for stasjoner og partisjoner i
     formen <emphasis>(hdn,m)</emphasis>, hvor <emphasis>n</emphasis>
    er harddisknummeret og <emphasis>m</emphasis> er partisjonensnummeret.
      Harddisknummeret starter fra null, men partisjonsnummeret
     starter fra én for vanlige partisjoner og fem for utvidede partisjoner.
     Merk at dette er forskjellig fra tidligere versjoner hvor
     begge tallene startet fra null. For eksempel partisjon <filename
    class="partition">sda1</filename> er <emphasis>(hd0,1)</emphasis> for
    GRUB og <filename class="partition">sdb3</filename> er
    <emphasis>(hd1,3)</emphasis>. I motsetning til Linux anser ikke GRUB
     CD-ROM-stasjoner som harddisker. For eksempel hvis du bruker en CD
     på <filename class="partition">hdb</filename> og en ekstra harddisk
     på <filename class="partition">hdc</filename>, vil den andre harddisken
     fortsatt være <emphasis>(hd1)</emphasis>.</para>

  </sect2>

  <sect2>
    <title>Sette opp konfigurasjonen</title>

    <para>GRUB fungerer ved å skrive data til det første fysiske sporet til en
     hardisk. Dette området er ikke en del av noe filsystem. programmene
     der gir tilgang til GRUB moduler i oppstartspartisjonen. Standardplasseringen
     er /boot/grub/.</para>

    <para>Plasseringen av oppstartspartisjonen er et valg av brukeren som
     påvirker konfigurasjonen. En anbefaling er å ha en egen liten
     (foreslått størrelse er 200 MB) partisjon kun for oppstartsinformasjon. På den måten
     hver bygging, enten LFS eller en kommersiell distro, kan få tilgang til den samme oppstartsfilen
     og tilgang kan gjøres fra hvilket som helst oppstartssystem. Hvis du velger å gjøre
     dette må du montere den separate partisjonen, flytte alle filene i
     nåværende <filename class="directory">/boot</filename> mappen (f.eks
     linuxkjernen du nettopp bygde i forrige seksjon) til den nye partisjonen.
     Du må da avmontere partisjonen og montere den på nytt som <filename
    class="directory">/boot</filename>.  Hvis du gjør dette, sørg for å oppdatere
    <filename>/etc/fstab</filename>.</para>

    <para>Bruk av gjeldende lfs partisjon vil også fungere, men konfigurasjon
     for flere systemer er vanskeligere.</para>

    <para>Bruk informasjonen ovenfor, finn ut hva som er riktig
     designator for rotpartisjonen (eller oppstartspartisjonen, hvis en separat
     er brukt). For det følgende eksempelet antas det at rot
     (eller separat oppstart) partisjon er <filename
    class="partition">sda2</filename>.</para>

    <para>Installer GRUB filene i <filename
    class="directory">/boot/grub</filename> og sett opp oppstartssporet:</para>

    <warning>
      <para>Følgende kommando vil overskrive gjeldende oppstartslaster. Ikke
       kjør kommandoen hvis dette ikke er ønsket, for eksempel hvis du bruker en tredjeparts
       boot manager for å administrere Master Boot Record (MBR).</para>
    </warning>

<screen role="nodump"><userinput>grub-install /dev/sda</userinput></screen>

    <note>
      <para>Hvis systemet har blitt startet opp med UEFI,
      <command>grub-install</command> vil prøve å installere filer for
      <emphasis>x86_64-efi</emphasis> målet, men disse filene
       er ikke installert i <xref linkend="chapter-building-system"/>.
      Hvis dette er tilfelle, legg til <option>--target i386-pc</option> til
       kommandoen ovenfor.</para>
    </note>

<!-- Dette ser ikke ut til å være sant lenger
    <note><para><application>grub-install</application> er et skript og kaller et annet
     program, grub-probe, som kan mislykkes med en melding "cannot stat `/dev/root'".
    I så fall oppretter du en midlertidig symbolsk lenke fra rotpartisjonen din til /dev/root:</para>

<screen role="nodump"><userinput>ln -sv /dev/sda2 /dev/root</userinput></screen>

    <para>Den symbolske lenken vil bare være tilstede til systemet startes på nytt.
     Koblingen er kun nødvendig for installasjonsprosedyren.
    </para></note>
-->
  </sect2>

  <sect2 id="grub-cfg">
    <title>Opprette GRUB konfigurasjonsfilen</title>

    <para>Generer <filename>/boot/grub/grub.cfg</filename>:</para>

    <screen><userinput>cat &gt; /boot/grub/grub.cfg &lt;&lt; "EOF"
<literal># Begin /boot/grub/grub.cfg
set default=0
set timeout=5

insmod ext2
set root=(hd0,2)

menuentry "GNU/Linux, Linux &linux-version;-lfs-&version;" {
        linux   /boot/vmlinuz-&linux-version;-lfs-&version; root=/dev/sda2 ro
}</literal>
EOF</userinput></screen>

    <note><para>Fra <application>GRUB</application> sitt perspektiv, 
     kjernefilene er i forhold til partisjonen som brukes. Hvis du
     brukte en separat /boot-partisjon, fjern /boot fra ovenstående
    <emphasis>linux</emphasis> linjen.  Du må også endre
    <emphasis>set root</emphasis> linjen for å peke på oppstartspartisjonen.
    </para></note>

    <para>GRUB er et ekstremt kraftig program og det gir en enorm
     antall alternativer for oppstart fra et bredt utvalg av enheter, operativ
     systemer og partisjonstyper. Det er også mange muligheter for tilpasning
     som grafiske splash-skjermer, avspilling av lyder, museinngang, etc.
     Detaljer om disse alternativene er utenfor rammen av disse introduksjonene.</para>

    <caution><para>Det er en kommando, <application>grub-mkconfig</application>, som
     kan skrive en konfigurasjonsfil automatisk. Den bruker et sett med skript i
     /etc/grub.d/ og vil ødelegge eventuelle tilpasninger du gjør. Disse skriptene
     er først og fremst designet for distribusjoner uten kilder og anbefales ikke for
     LFS. Hvis du installerer en kommersiell Linux distribusjon, er det en god sjanse
     at dette programmet skal kjøres. Sørg for å sikkerhetskopiere grub.cfg filen.</para></caution>

   </sect2>

</sect1>
